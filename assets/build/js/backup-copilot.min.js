var BKPC = BKPC || {};var $ = jQuery || {};BKPC.uuid = Math.floor(new Date().getTime() / 1000);BKPC.timerInstance;BKPC.progressBarInstance;BKPC.progressNoticeInstance;BKPC.dismissNotice = function (event){event.preventDefault();$elem = $(event.target);$elem.closest('.bkpc-notice-dimiss.is-dismissible').remove();};BKPC.showCustomFileUploadURL = function (event){event.preventDefault();$elem = $(event.target);$span = $('.bkpc-custom-file-upload span').empty();($elem.val()) ? $span.text($elem[0].files[0].name) : $span.text('Choose Backup File...');};BKPC.toggleAdvancedOptions = function (event){event.preventDefault();$elem = $(event.target);$elem.find('i.dashicons').toggleClass('dashicons-arrow-right').toggleClass('dashicons-arrow-down');$('.bkpc-advanced-options').fadeToggle();};BKPC.startTimer = function ($container){var timer = 0, minutes, seconds;BKPC.timerInstance = setInterval(function () {minutes = parseInt(timer / 60, 10);seconds = parseInt(timer % 60, 10);minutes = minutes < 10 ? '0' + minutes : minutes;seconds = seconds < 10 ? '0' + seconds : seconds;$container.text(minutes + ':' + seconds);timer++;}, 1000);};BKPC.stopTimer = function ($container){clearInterval(BKPC.timerInstance);$container.empty();};BKPC.startProgressBar = function ($container){var width;$container.append($('<div/>').addClass('bkpc-progressbar'));BKPC.progressBarInstance = setInterval(function () {width = $('.bkpc-progressbar').width() + 10;if (width >= $(document).width() - width) {$('.bkpc-progressbar').css({ 'width': '0px' });} else {$('.bkpc-progressbar').css({ 'width': width + 'px' });}}, 100);};BKPC.stopProgressBar = function ($container){clearInterval(BKPC.progressBarInstance);$container.find('.bkpc-progressbar').remove();};BKPC.progressBar = function ($container){$container.append($('<div/>').addClass('bkpc-progressbar'));BKPC.startProgressBar()};BKPC.startProgressNotice = function ($container){var backup_progress_url = bkpc_create_backup.url + BKPC.uuid + '/progress.txt';BKPC.progressNoticeInstance = setInterval(function () {$.ajax({method: 'get',url: backup_progress_url,xhr: function () {var xhr = $.ajaxSettings.xhr();xhr.onprogress = function (event) {$.get(backup_progress_url, function (data) {var re = new RegExp(/\[Done\]/, 'g');BKPC.showNotice(data.replace(re, '<strong>[Done]</strong><br />'), 'notice-info bkpc-notice-progress');});};return xhr;},});}, 1000);};BKPC.stopProgressNotice = function (){clearInterval(BKPC.progressNoticeInstance);};BKPC.showNotice = function (message, className = 'notice-success'){$('.bkpc-notice-container').empty();$('.bkpc-notice-container').append($('<div/>').addClass('notice bkpc-notice-dimiss is-dismissible ' + className).html('<button type="button" class="notice-dismiss bkpc-notice-dismiss"><span class="screen-reader-text">Dismiss this notice.</span></button><p>' + message + '</p>'));};BKPC.reloadAllBackups = function ($button){$('#bkpc-all-backups-container').load(' #bkpc-all-backups-container > *');$button.prop('disabled', false);};BKPC.getTextFieldArray = function ($elem){var array = [];$elem.each(function () {array.push($(this).val());});return array;};BKPC.humanFileSize = function (bytes, si = false, dp = 1){var thresh = si ? 1000 : 1024;if (Math.abs(bytes) < thresh) {return bytes + ' B';}var units = si ? ['kB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'] : ['KiB', 'MiB', 'GiB', 'TiB', 'PiB', 'EiB', 'ZiB', 'YiB'];let u = -1;var r = 10**dp;do {bytes /= thresh;++u;} while (Math.round(Math.abs(bytes) * r) / r >= thresh && u < units.length - 1);return bytes.toFixed(dp) + ' ' + units[u];};(function ($, undefined) {$(document).on('click', '.bkpc-notice-dismiss', BKPC.dismissNotice);$(document).on('click', '.bkpc-advanced-options-toggle', BKPC.toggleAdvancedOptions);$(document).on('change', '.bkpc-custom-file-upload input[name="backup-file"]', BKPC.showCustomFileUploadURL);})(jQuery);var BKPC = BKPC || {};var $ = jQuery || {};BKPC.ajaxBeforeSend = function ($elem){$elem.prop("disabled", true);BKPC.startTimer($('.bkpc-timer'));BKPC.startProgressBar($('body'));BKPC.startProgressNotice();};BKPC.ajaxSuccess = function ($elem, data, reload = true){BKPC.stopTimer($('.bkpc-timer'));BKPC.stopProgressBar($('body'));BKPC.stopProgressNotice();BKPC.showNotice(JSON.parse(data));if (reload === true) {BKPC.reloadAllBackups($elem);}};BKPC.ajaxError = function ($elem, message){BKPC.stopTimer($('.bkpc-timer'));BKPC.stopProgressBar($('body'));BKPC.stopProgressNotice();BKPC.showNotice(message);BKPC.reloadAllBackups($elem);};var BKPC = BKPC || {};var $ = jQuery || {};BKPC.createBackup = function (event){event.preventDefault();var $elem = $(event.target);var $form = $(event.target).closest('form');BKPC.uuid = Math.floor(new Date().getTime() / 1000);$.ajax({method: 'post',url: bkpc.ajax_url,data: {action: 'create_backup',uuid: BKPC.uuid,notes: $form.find('input[name="notes"]').val(),advanced_options: BKPC.getTextFieldArray($("input[name='advanced-options']:checked")),find_text: BKPC.getTextFieldArray($("input[name='find-text']")),replace_with_text: BKPC.getTextFieldArray($("input[name='replace-with-text']"))},beforeSend: function () {BKPC.ajaxBeforeSend($elem);},success: function (data, status, jqxhr) {BKPC.ajaxSuccess($elem, data);$form.find('input[name="notes"]').val('');},error: function (jqxhr, status, error) {BKPC.ajaxError($elem, 'Server timeout! Created backup files could be corrupted.');}});};(function ($, undefined) {  $(document).on('click', 'button[name="create-backup"]', BKPC.createBackup);})(jQuery);var BKPC = BKPC || {};var $ = jQuery || {};BKPC.deleteBackup = function (event){event.preventDefault();var $elem = $(event.target);var $form = $(event.target).closest('form');$.ajax({method: 'post',url: bkpc.ajax_url,data: {action: 'delete_backup',uuid: $form.find("input[name=uuid]").val()},beforeSend: function () {BKPC.ajaxBeforeSend($elem);if ($form.find("input[name=download_url]").length&& $form.find("input[name=uuid]").length) {var url        = $form.find("input[name=download_url]").val();var filename   = $form.find("input[name=uuid]").val() + '.zip';var anchorElem = $('<a/>').css('display', 'none').attr({ 'href': url, 'download': filename });$('body').append(anchorElem);anchorElem[0].click();anchorElem.remove();} },success: function (data, status, jqxhr) {BKPC.ajaxSuccess($elem, data);},error: function (jqxhr, status, error) {BKPC.ajaxError($elem, 'Ajax error! Backup delete failed.');}});};(function ($, undefined) {  $(document).on('click', 'button[name="delete-backup"]', BKPC.deleteBackup);})(jQuery);var BKPC = BKPC || {};var $ = jQuery || {};BKPC.downloadBackup = function (event){event.preventDefault();var $elem = $(event.target);var $form = $(event.target).closest('form');$.ajax({method: 'post',url: bkpc.ajax_url,data: {action: 'download_backup',uuid: $form.find("input[name=uuid]").val()},beforeSend: function () {BKPC.ajaxBeforeSend($elem);},success: function (data, status, jqxhr) {BKPC.ajaxSuccess($elem, data);},error: function (jqxhr, status, error) {BKPC.ajaxError($elem, 'Ajax error! Backup download failed.');}});};(function ($, undefined) {  $(document).on('click', 'button[name="download-backup"]', BKPC.downloadBackup);})(jQuery);var BKPC = BKPC || {};var $ = jQuery || {};BKPC.exportBackup = function (event) {event.preventDefault();var $elem = $(event.target);var $form = $(event.target).closest('form');BKPC.uuid = Math.floor(new Date().getTime() / 1000);$.ajax({method: 'post',url: bkpc.ajax_url,data: {action: 'export_backup',uuid: BKPC.uuid,notes: $form.find('input[name="notes"]').val(),advanced_options: BKPC.getTextFieldArray($("input[name='advanced-options']:checked")),find_text: BKPC.getTextFieldArray($("input[name='find-text']")),replace_with_text: BKPC.getTextFieldArray($("input[name='replace-with-text']"))},beforeSend: function() {BKPC.ajaxBeforeSend($elem);},success: function (data, status, jqxhr) {BKPC.ajaxSuccess($elem, data, false);$elem.prop('disabled', false);$form.find('input[name="notes"]').val('');},error: function (jqxhr, status, error) {BKPC.ajaxError($elem, 'Ajax error! Backup export failed.');}});};(function ($, undefined) {  $(document).on('click', 'button[name="export-backup"]', BKPC.exportBackup);})(jQuery);var BKPC = BKPC || {};var $ = jQuery || {};BKPC.restoreBackup = function (event){event.preventDefault();var $elem = $(event.target);var $form = $(event.target).closest('form');$.ajax({method: 'post',url: bkpc.ajax_url,data: {action: 'restore_backup',uuid: $form.find("input[name=uuid]").val()},beforeSend: function () {BKPC.ajaxBeforeSend($elem);},success: function (data, status, jqxhr) {BKPC.ajaxSuccess($elem, data);},error: function (jqxhr, status, error) {BKPC.ajaxError($elem, 'Ajax error! Backup restore failed.');}});};(function ($, undefined) {  $(document).on('click', 'button[name="restore-backup"]', BKPC.restoreBackup);})(jQuery);var BKPC = BKPC || {};var $ = jQuery || {};BKPC.uploadBackup = function (event){event.preventDefault();var $elem = $(event.target);var $form = $(event.target).closest('form');var $form_data = new FormData();$form_data.append('action', 'upload_backup');$form_data.append('file', $('input[name="backup-file"]')[0].files[0]);$.ajax({method: 'post',url: bkpc.ajax_url,data: $form_data,cache: false,processData: false,contentType: false,beforeSend: function () {BKPC.ajaxBeforeSend($elem);},success: function (data, status, jqxhr) {BKPC.ajaxSuccess($elem, data, true);$form.find('input[name="backup-file"]+span').text('Choose Backup File...');},error: function (jqxhr, status, error) {BKPC.ajaxError($elem, 'Ajax error! Backup upload failed.');}});};(function ($, undefined) {  $(document).on('click', 'button[name="upload-backup"]', BKPC.uploadBackup);})(jQuery);